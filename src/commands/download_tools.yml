description: >
  Download files and tools required

parameters:
  version:
    type: string
    default: ""

steps:
  - run:
      name: Download PHP Unit
      command: <<include(scripts/download_php_unit.sh)>>
  - run:
      name: Decompress Magento
      command: tar xpf Magento<< parameters.version >>-PreCompiled.tar.gz
  - run:
      name: Move Magento files
      command: mv magento2/* .
  - run:
      name: Delete tar
      command: rm Magento<< parameters.version >>-PreCompiled.tar.gz
  - run:
      name: Delete old code
      command: rm -rf app/code/Ebizmarts
  - run:
      name: Download magento Composer auth.json file
      command: wget --quiet $MAGENTO_COMPOSER_AUTH
  - run:
      name: Set bin/magento as executable
      command: chmod +x bin/magento
  - checkout:
      path: app/code/Ebizmarts/SagePaySuite
  - run:
      name: Create folder for Opayo
      command: <<include(scripts/create_opayo_folder.sh)>>
  - run:
      name: Copy Api test data files to folder
      command: <<include(scripts/cp_api_test_data.sh)>>
  - run:
      name: Copy php unit config file
      command: <<include(scripts/cp_php_unit_config.sh)>>
  - run:
      name: Copy integration tests config file
      command: <<include(scripts/cp_int_test_config.sh)>>
  - run:
      name: Copy api functional config file
      command: <<include(scripts/cp_api_func_test_config.sh)>>
